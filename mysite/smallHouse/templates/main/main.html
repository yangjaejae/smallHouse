{% extends 'base_layout.html' %}
{% load staticfiles %}

{% block content %}
<div id="map" style="height:800px; width: 100%;">
    <div class="top_layer_nav">
        <div class="top_layer_search">
            <input type="text" class="top_layer_keyword" placeholder="검색어를 입력하세요"/>
            <input type="button" class="top_layer_btn"/>
        </div>
        <div class="sub-filter">
            <div class="sub-filter-layer">
                <div class="menu-container">
                    <ul>
                        <li>매매</li>
                        <li>전세</li>
                        <li>상가</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="top_layer_info" style="overflow: scroll;">
        <div class="info_nav" style="background-color: cornflowerblue; color:white; text-align:center;">
            <h5>뉴스</h3>
        </div>
            <div class="info_nav_text">
                <table>
                    {% for new in news %}
                    <tr>
                        <td>
                            <a href="{{ new.url }}">
                                <p>{{ new.title }}</p>
                            </a>
                            <p>-{{ new.newspaper }}-</p>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
    </div>
</div>
<script>
    var mapOptions = {
        center: new naver.maps.LatLng(37.498189, 127.027642),
        zoom: 10,
        minZoom: 1, //지도의 최소 줌 레벨
        zoomControl: true, //줌 컨트롤의 표시 여부
        zoomControlOptions: { //줌 컨트롤의 옵션
            position: naver.maps.Position.TOP_RIGHT
        },
        mapTypeControl: true,
        mapTypeControlOptions: {
            style: naver.maps.MapTypeControlStyle.BUTTON,
            position: naver.maps.Position.TOP_RIGHT
        }
    };
    var map = new naver.maps.Map('map', mapOptions);

    function getMarker(listMap){
        
        var dataList = listMap.result
        for( var i=0; i < dataList.length; i++ ){
            var addr = dataList[i].location + dataList[i].loc_num;
            naver.maps.Service.geocode({
                address: addr
            }, function(status, response) {
                if (status !== naver.maps.Service.Status.OK) {
                    return alert('Something wrong!');
                }
                var result = response.result, // 검색 결과의 컨테이너
                items = result.items; // 검색 결과의 배열
                
                var lng = items[0].point.x;
                var lat = items[0].point.y;

                var marker = new naver.maps.Marker({
                    position: new naver.maps.LatLng(lat, lng),
                    map: map,
                    icon: {
                        content: '<img src="{% static "img/marker_pin.png" %}" alt="" style="margin: 0px; padding: 0px; border: 0px solid transparent; display: block; max-width: none; max-height: none; -webkit-user-select: none; position: absolute; width: 22px; height: 35px; left: 0px; top: 0px;">',
                        size: new naver.maps.Size(22, 35),
                        anchor: new naver.maps.Point(11, 35)
                    }
                    {% comment %} 
                    name: dataList[i].name,
                    price: dataList[i].price,
                    fnd_year: dataList[i].fnd_year,
                    sold_date: dataList[i].sold_date,
                    location: dataList[i].location,
                    loc_num: dataList[i].loc_num,
                    loc_cd: dataList[i].loc_cd,
                    floor: dataList[i].floor 
                    {% endcomment %}
                });

            });
        }
    }
    
    $(document).ready(function(){
        
        $(".top_layer_btn").click(function(){
            var word = $(".top_layer_keyword").val();
            alert(word)
            $.ajax({
                type: 'GET',
                url: '{% url "getAddress" %}', 
                data: {
                    "word": word
                },
                dataType: 'json',
                error: function( jqXHR, textStatus, errorThrown ){
                    alert('status: ' + textStatus + '\nerror: ' + jqXHR.error )
                },
                success: function(datas){
                    getMarker(datas);
                }
            });

        });

    });

</script>
{% endblock %}